# 4bsop ì»¤ë¨¸ì…œ ì›¹ì‚¬ì´íŠ¸ ì œì‘ (Backend)
ì¥ë‹¤í¬ ([**Github**](https://github.com/walwald), [íšŒê³ ë¡](https://walwaldev.tistory.com/49))<br>
ì™•ê´‘í˜„ ([íšŒê³ ë¡](https://khwang24.tistory.com/14))<br>
> ìœ„ì½”ë“œ 44ê¸° 1ì°¨ í”„ë¡œì íŠ¸ <br>
> í•˜ì´ì—”ë“œ í™”ì¥í’ˆ ë¸Œëœë“œ Aesopì„ ëª¨ë¸ë§í•˜ì—¬ ì»¤ë¨¸ì…œ ì›¹ì‚¬ì´íŠ¸ ì œì‘<br>
[ê²°ê³¼ë¬¼ url](http://s3-hosting-jiyeoun.s3-website.ap-northeast-2.amazonaws.com/)

> **ì§§ì€ í”„ë¡œì íŠ¸ ê¸°ê°„ë™ì•ˆ ê°œë°œì— ì§‘ì¤‘í•´ì•¼ í•˜ë¯€ë¡œ ë””ìì¸/ê¸°íš ë¶€ë¶„ë§Œ í´ë¡ í–ˆìŠµë‹ˆë‹¤.<br>
ê°œë°œì€ ì´ˆê¸° ì„¸íŒ…ë¶€í„° ì „ë¶€ ì§ì ‘ êµ¬í˜„í–ˆìœ¼ë©°, ì•„ë˜ ë°ëª¨ ì˜ìƒì—ì„œ ë³´ì´ëŠ” ë¶€ë¶„ì€ ëª¨ë‘ ë°±ì•¤ë“œì™€ ì—°ê²°í•˜ì—¬ ì‹¤ì œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ ìˆ˜ì¤€ìœ¼ë¡œ ê°œë°œí•œ ê²ƒì…ë‹ˆë‹¤.*

## ğŸ“í”„ë¡œì íŠ¸ ê¸°ê°„ & ì¸ì›
* í”„ë¡œì íŠ¸ ê¸°ê°„: 2ì£¼ (2023.04.03 ~ 2023.04.16)   
* ê°œë°œ ì¸ì›:  
  `Frontend`: ê¹€ì˜ìš´, ë°•ì§€ì—° <br>
  `Backend`: ì¥ë‹¤í¬(Project Manager), ì™•ê´‘í˜„(Product Manager) <br>
* [í”„ë¡ íŠ¸ì—”ë“œ Github ì €ì¥ì†Œ](https://github.com/wecode-bootcamp-korea/44-1st-four-branch-frontend)
* ëª¨ë¸ë§í•œ ì‚¬ì´íŠ¸: [ì´ì†(Aesop)](https://www.aesop.com/kr/)
 
 ## ğŸ“ì‚¬ìš© ê¸°ìˆ 

* BackEnd   

 |JavaScript|Node.js|MySql|Rest|Prettier|Docker|AWS|
|---|---|---|---|---|---|---|
|<div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/js-icon.svg" alt="icon" width="65" height="65" /></div>| <div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/nginx-icon.svg" alt="icon" width="65" height="65" /></div>| <div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/mysql-icon.svg" alt="icon" width="65" height="65" /></div>|<div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/restapi-icon.svg" alt="icon" width="65" height="65" /></div>|<div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/prettier-icon.svg" alt="icon" width="65" height="65" /></div>|<div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/docker-icon.svg" alt="icon" width="65" height="65" /></div>|<div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/aws-icon.svg" alt="icon" width="65" height="65" /></div>|
<br>

* í˜‘ì—… <br><br>
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white"> <br>
<img src="https://img.shields.io/badge/trello-0055cc?style=for-the-badge&logo=trello&logoColor=yellow"> <br>
<img src="https://img.shields.io/badge/slack-4A154B?style=for-the-badge&logo=Slack&logoColor=wihte"> <br>
<img src="https://img.shields.io/badge/notion-000000?style=for-the-badge&logo=notion&logoColor=white"> <br>

 ## ğŸ“ERD
 
![image](https://user-images.githubusercontent.com/120387100/233080857-d5912540-1add-4c1d-aa7f-048d97d52026.png)

 ## ğŸ“í•µì‹¬ ê¸°ëŠ¥
 > ì‡¼í•‘ëª° ì›¹ì‚¬ì´íŠ¸ì˜ í•µì‹¬ ê¸°ëŠ¥ì¸ [íšŒì›ê°€ì…/ë¡œê·¸ì¸, ìƒí’ˆ ë¦¬ìŠ¤íŠ¸, ìƒí’ˆ ìƒì„¸ ì •ë³´, ìƒí’ˆ ê²€ìƒ‰, ì¥ë°”êµ¬ë‹ˆ, ì£¼ë¬¸, ê²°ì œ] ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.
 
<details>
<summary>í•µì‹¬ ê¸°ëŠ¥ ì„¤ëª… í¼ì¹˜ê¸°</summary>
<div markdown="1">
  
 ### Users
 
 **íšŒì›ê°€ì…**
 
 ![image](https://user-images.githubusercontent.com/120387100/233130362-68af441f-5992-4719-bc03-48cd543a8711.png)
 
 : ê³ ê°€ í™”ì¥í’ˆ ë¸Œëœë“œ íŠ¹ì„±ìƒ êµ¬ë§¤ ì£¼ê¸°ê°€ ê¸¸ê³  ì„ ë¬¼ìš© 1íšŒì„± êµ¬ë§¤ê°€ ë§ë‹¤ëŠ” ì ì„ ê³ ë ¤í•˜ì—¬, user ìˆ˜ì§‘ ì •ë³´ë¥¼ ìµœì†Œí™”í•˜ê³  ì‰½ê³  ê°„í¸í•œ íšŒì› ê°€ì… ê¸°ëŠ¥ êµ¬í˜„
 - ì •ê·œí‘œí˜„ì‹ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ì˜ ìœ íš¨ì„± ê²€ì¦
 - ê¸° ê°€ì…ëœ ì´ë©”ì¼ë¡œ ì¤‘ë³µ ê°€ì… ì‹œë„ ì‹œ ê°€ì… ë¶ˆê°€í•˜ë„ë¡ ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜
 - bcryptë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” í›„ DBì— ì €ì¥
<br> 

 **ë¡œê·¸ì¸**
 
![image](https://user-images.githubusercontent.com/120387100/233130405-6b5bf0ed-6f61-4cdc-9957-0603b8e25b4a.png)

 - DBë‚´ ì €ì¥ëœ ì•”í˜¸í™” ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ bcryptë¡œ ì•”í˜¸í™”í•˜ì—¬ ë¹„êµ í›„ ë¶ˆì¼ì¹˜í•˜ì§€ ì‹œ ì—ëŸ¬ ë©”ì„¸ì§€ ë°˜í™˜ 
 - jwtë¥¼ í™œìš©í•˜ì—¬ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ payloadì— user idê°€ ë‹´ê¸´ í† í° ë°œê¸‰

***
 
 ### Products

 **ìƒí’ˆ ì •ë³´** 
  
![image](https://user-images.githubusercontent.com/120387100/233131367-a349f24d-f75d-429f-9158-7b4dfa8e147a.png)
![image](https://user-images.githubusercontent.com/120387100/233131390-f4d465d4-f806-4174-bfd1-8b8f5f4744d2.png)
![image](https://user-images.githubusercontent.com/120387100/233131416-2b3529d5-e080-4f50-9f9f-ed494d101c01.png)
![image](https://user-images.githubusercontent.com/120387100/233132070-5c251208-72a1-4a47-ada9-61a4384437e8.png)

 : ë©”ì¸ ì¹´í…Œê³ ë¦¬/ì„œë¸Œ ì¹´í…Œê³ ë¦¬ í•„í„°, ê°€ê²©ìˆœ ì •ë ¬, ìƒí’ˆ id í•„í„° ì ìš© ê°€ëŠ¥í•œ ìƒí’ˆ ì •ë³´ ì¡°íšŒ API êµ¬í˜„
 - Frontendì—ì„œ ë™ì¼í•œ endpointì— í•„ìš”ì— ë”°ë¼ ì¡°ê±´ì„ query parameterë¡œ ì¶”ê°€ì—¬ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„
 - ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ì™€ ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ì— ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥
 - í™”ì¥í’ˆì— ìˆì–´ ì„±ë¶„ì´ ì¤‘ìš”í•œ ìš”ì†Œì´ë¯€ë¡œ, ì„±ë¶„ê³¼ ìƒí’ˆì´ ë‹¤ëŒ€ë‹¤ ê´€ê³„ì¸ ERD êµ¬ì¶•
 - Product Dao ë‚´ í•¨ìˆ˜ì—ì„œ ë‹¨ë½í‰ê°€ë¥¼ í™œìš©í•˜ì—¬ ê° ì¡°ê±´ë¬¸ì˜ ì¸ì ìœ ë¬´ë¥¼ íŒë‹¨, í•˜ë‚˜ì˜ queryë¬¸ìœ¼ë¡œ ë™ì‘í•˜ë„ë¡ í•¨
 - Order byì™€ Sorting, Offsetê³¼ Limitì™€ ê°™ì´ ë‘ ì¸ìê°€ í•¨ê»˜ ìˆ˜ì‹ ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°, í•˜ë‚˜ì˜ ì¸ìë§Œ ìˆ˜ì‹ ë˜ì—ˆì„ ë•Œ ì—ëŸ¬ ë©”ì‹œì§€ ë…¸ì¶œ
<br>

**ìƒí’ˆ ê²€ìƒ‰**

![image](https://user-images.githubusercontent.com/120387100/233131707-1717bbf3-4e15-45e6-8c02-fda2069340af.png)

 : ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œ í•´ë‹¹ ë‹¨ì–´ê°€ ìƒí’ˆëª…ì— í¬í•¨ëœ ìƒí’ˆ ì •ë³´ ë¦¬ìŠ¤íŠ¸ ì „ì†¡ API êµ¬í˜„
 - ê²€ìƒ‰ì–´ë¥¼ query parameterë¡œ ìˆ˜ì‹ í•˜ì—¬ ê²€ìƒ‰ì–´ê°€ ìƒí’ˆëª…ì— í¬í•¨ëœ ìƒí’ˆë“¤ì˜ ìƒí’ˆ id, ìƒí’ˆëª…, ì´ë¯¸ì§€url ì „ì†¡ 
***
### ì¸ê°€(Authorization)
: ì¥ë°”êµ¬ë‹ˆ, ì£¼ë¬¸, ê²°ì œ ê¸°ëŠ¥ ì´ìš© ì‹œ tokenì„ í•´ë…í•˜ì—¬ payloadì˜ user id í™•ì¸ í›„ ê°€ì…ëœ ê³ ê°ë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ middleware êµ¬í˜„
- tokenì´ ìˆ˜ì‹ ë˜ì§€ ì•Šì€ ê²½ìš° tokenì´ í•„ìš”í•˜ë‹¤ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜
- payload ë‚´ user idê°€ DBì—ì„œ í™•ì¸ë˜ì§€ ì•Šì„ ê²½ìš° ìœ íš¨í•˜ì§€ ì•Šì€ userë¼ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜
***
### Carts

**ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì¶”ê°€**

![image](https://user-images.githubusercontent.com/120387100/233132301-3e610122-ba96-481d-918e-f0107bf53d7e.png)

![image](https://user-images.githubusercontent.com/120387100/233133239-4255f179-2d67-41a7-b5d2-c7c481fbc39d.png)

: ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ì—ì„œ 'ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€' ë²„íŠ¼ í´ë¦­ ì‹œ cart DBì— ìƒí’ˆì´ ì¶”ê°€ë˜ê³  ì¥ë°”êµ¬ë‹ˆ ë‚´ì—­ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” API êµ¬í˜„
- Cart Dao ë‚´ queryë¬¸ì—ì„œ ON DUPLICATEì„ í™œìš©í•˜ì—¬, ì¹´íŠ¸ì— íŠ¹ì • ìƒí’ˆì´ ë‹´ê²¨ìˆëŠ” ê²½ìš° 'ì¹´íŠ¸ì— ë‹´ê¸°'ë¥¼ í´ë¦­í•˜ì˜€ì„ ë•Œ ìˆ˜ëŸ‰ì´ 1 ì¦ê°€í•˜ë„ë¡ êµ¬í˜„
<br>

**ì¥ë°”êµ¬ë‹ˆ ë‚´ ìƒí’ˆ ìˆ˜ëŸ‰ ë³€ê²½**

![image](https://user-images.githubusercontent.com/120387100/233133400-08bf4ff8-9f3d-44ee-afc9-7b508cdb9b36.png)


: ì¥ë°”êµ¬ë‹ˆì—ì„œ ìƒí’ˆ ìˆ˜ëŸ‰ ë³€ê²½ ì‹œ cart DBì˜ ìƒí’ˆ ìˆ˜ëŸ‰ì´ ë³€ê²½ë˜ê³  ì¥ë°”êµ¬ë‹ˆ ë‚´ì—­ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” API êµ¬í˜„
<br><br>

**ì¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì‚­ì œ**

![image](https://user-images.githubusercontent.com/120387100/233133271-1f133a53-abeb-49e3-9e51-e72904539118.png)

![image](https://user-images.githubusercontent.com/120387100/233133602-47bf7e6b-5042-411b-83af-dda58d08f8fe.png)

: ì¥ë°”êµ¬ë‹ˆì—ì„œ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ cart DBì˜ ìƒí’ˆì´ ì‚­ì œë˜ê³  ì¥ë°”êµ¬ë‹ˆ ë‚´ì—­ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” API êµ¬í˜„
***

### Orders
**ì£¼ë¬¸**

![image](https://user-images.githubusercontent.com/120387100/233134954-fbd62c3f-09bd-48cc-8c02-db69ab90607d.png)
![image](https://user-images.githubusercontent.com/120387100/233135394-8e089560-a7c7-4bf5-bb7e-dc891c19df2f.png)

: ë°°ì†¡ ì£¼ì†Œ ë³„ë„ ì €ì¥ í›„, ì£¼ë¬¸ ì •ë³´ì™€ ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ë¥¼ DBì— ì €ì¥í•˜ëŠ” API êµ¬í˜„
- uuidë¥¼ ì‚¬ìš©í•˜ì—¬ ê³ ìœ  ì£¼ë¬¸ ë²ˆí˜¸ ìƒì„±
- MySqlì˜ transaction ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ `ì£¼ë¬¸ ì •ë³´ ì €ì¥`ê³¼ `ì£¼ë¬¸ ìƒí’ˆ ì •ë³´ ì €ì¥`ì´ í•¨ê»˜ ì´ë£¨ì–´ì§€ê³ , ì—ëŸ¬ ë°œìƒ ì‹œ í•¨ê»˜ ì² íšŒë˜ë„ë¡ êµ¬í˜„
<br>

**ê²°ì œ**

![image](https://user-images.githubusercontent.com/120387100/233135433-974e157e-5517-4c4e-8ae3-8be6ad1e885b.png)
![image](https://user-images.githubusercontent.com/120387100/233135468-f971555b-eb8e-495c-bcdb-4d58842bfa4a.png)

: íšŒì›ì´ ë³´ìœ í•œ í¬ì¸íŠ¸ë¡œ ì£¼ë¬¸ ì´ì•¡ì´ ê²°ì œëœ í›„ ì£¼ë¬¸ ë‚´ì—­ ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” API êµ¬í˜„
- MySqlì˜ transaction ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ 'ê³ ê° í¬ì¸íŠ¸ ì°¨ê°, ì£¼ë¬¸ ë° ì£¼ë¬¸ ìƒí’ˆ ìƒíƒœ `ê²°ì œ ëŒ€ê¸°`ì—ì„œ `ê²°ì œ ì™„ë£Œ`ë¡œ ë³€ê²½, ì¹´íŠ¸ ë‚´ì—­ ì‚­ì œ'ê°€ í•¨ê»˜ ë™ì‘í•˜ë©°, ì—ëŸ¬ ë°œìƒ ì‹œ í•¨ê»˜ ì² íšŒë˜ë„ë¡ êµ¬í˜„
- ì£¼ë¬¸ ì´ì•¡ì´ ë³´ìœ  í¬ì¸íŠ¸ë³´ë‹¤ ì ì„ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜
- ê²°ì œ ì™„ë£Œ í›„ ì£¼ë¬¸ ë° ê²°ì œ ì™„ë£Œ ìƒíƒœì˜ ì£¼ë¬¸ ë‚´ì—­ ë°˜í™˜
</div>
</details>
<br>

## ğŸ“í•µì‹¬ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
 **1. ìƒí’ˆ ì¡°íšŒ API - productDao ì¿¼ë¦¬ë¬¸ íš¨ìœ¨í™”**
- ìƒí’ˆë¦¬ìŠ¤íŠ¸ì™€ ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ êµ¬í˜„ì„ ìœ„í•´ [ìƒìœ„ ì¹´í…Œê³ ë¦¬, í•˜ìœ„ ì¹´í…Œê³ ë¦¬, ì •ë ¬ ì¡°ê±´, í˜ì´ì§€ë„¤ì´ì…˜, ìƒí’ˆ id] ë“± ë‹¤ì–‘í•œ ì¡°ê±´ì— ë”°ë¼ ìƒí’ˆ ì •ë³´ë¥¼ ë³´ë‚´ëŠ” API êµ¬í˜„í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. 
- ì²˜ìŒì—ëŠ” ê° ì¡°ê±´ì— ë”°ë¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” queryë¬¸ì´ í¬í•¨ëœ functionì„ productDao ë‚´ì— ê°ê° ì‘ì„±í–ˆìŠµë‹ˆë‹¤. 
- ê°™ì€ SELECTë¬¸ì— ì¡°ê±´ë§Œ ë‹¤ë¥´ê²Œ ë¶™ì€ í•¨ìˆ˜ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ê³¼ì •ì—ì„œ, í•˜ë‚˜ì˜ í•¨ìˆ˜ë¡œ ì´ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ëŠ” ì—†ì„ê¹Œ í•˜ëŠ” ì˜êµ¬ì‹¬ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

  <details>
  <summary>ê¸°ì¡´ ì½”ë“œ</summary>
  <div markdown="1">
  
    - ì¡°ê±´ì— ë”°ë¼ ifë¬¸ì´ ì‹¤í–‰ë˜ë„ë¡ ì„¤ê³„
    
    ```Javascript
    //productDao.js - ifë¬¸ì„ í™œìš©í•œ getProductByCondition í•¨ìˆ˜

    const getProductsByCondition = async (subId, mainId, pId, isMain) => {
      try {
        let condition = '';
        if (subId) {
          condition = `WHERE sc.id = ${subId}`;
        } else if (mainId) {
          condition = `WHERE m.id = ${mainId}`;
        } else if (pId) {
          condition = `WHERE p.id = ${pId}`;
        } else if (isMain) {
          condition = `WHERE p.main_product = ${isMain}`;
        }

        return await appDataSource.query(
          `SELECT 
            p.id,
            p.name,
            p.price,
            p.description,
            p.size_id sizeId,
            p.sub_category_id subCategoryId,
            s.size size,
            sc.name subCategoryName,
            m.id mainCategoryId,
            m.name mainCategoryName,
            i.url imageUrl,
            joined_ig.ig_array ingredients
        FROM products p
        JOIN sizes s ON p.size_id = s.id
        JOIN sub_categories sc ON sc.id = p.sub_category_id
        JOIN main_categories m ON sc.main_category_id = m.id
        JOIN products_images pi ON p.id = pi.product_id
        JOIN images i ON i.id = pi.image_id
        JOIN (
            SELECT
                pig.product_id pid,
                JSON_ARRAYAGG(ig.name) ig_array
            FROM ingredients ig
            JOIN products_ingredients pig ON pig.ingredient_id = ig.id
            GROUP BY pig.product_id
        ) joined_ig ON joined_ig.pid = p.id        
        ${condition}`
        );
      } catch (err) {
        err.message = 'DATABASE_ERROR';
        err.statusCode = 400;
        throw err;
      }
    };
  ```
  </div>
  </details>
    
 - ê¸°ì¡´ ì½”ë“œì—ì„œëŠ” ì •ë ¬ê³¼ í˜ì´ì§€ë„¤ì´ì…˜ì´ ë™ì‹œì— ì ìš©ë˜ê¸° ì–´ë µë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹«ê³ , ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `ë‹¨ì¶• í‰ê°€`ë¥¼ í™œìš©í•˜ì—¬ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
  
    <details>
    <summary>ìˆ˜ì •ëœ ì½”ë“œ</summary>
    <div markdown="1">
      
      ```JavaScript
      //productDao.js - ë‹¨ì¶• í‰ê°€ë¥¼ í™œìš©í•œ getProductsByCondition í•¨ìˆ˜

      const getProductsByCondition = async (
        subId,
        mainId,
        pId,
        isMain,
        orderBy,
        sorting,
        offset = 0,
        limit = 10
      ) => {
        try {
          const conditions = [
            subId && `WHERE sc.id = ${subId}`,
            mainId && `WHERE m.id = ${mainId}`,
            pId && `WHERE p.id = ${pId}`,
            isMain && `WHERE p.main_product = ${isMain}`,
          ].filter(Boolean);

          const orderings = [
            orderBy && `ORDER BY ${orderBy}`,
            sorting && `${sorting}`,
          ].filter(Boolean);

          const pagination = [
            limit && `LIMIT ${limit}`,
            offset && `OFFSET ${offset}`,
          ].filter(Boolean);

          const condition = conditions[0] || '';
          const ordering = orderings.join(' ') || '';
          const paging = pagination.join(' ') || '';

          return await appDataSource.query(
            `SELECT 
              p.id,
              p.name,
              p.price,
              p.description,
              p.summary,
              p.size_id sizeId,
              p.sub_category_id subCategoryId,
              s.size size,
              sc.name subCategoryName,
              m.id mainCategoryId,
              m.name mainCategoryName,
              i.url imageUrl,
              joined_ig.ig_array ingredients
          FROM products p
          LEFT JOIN sizes s ON p.size_id = s.id
          LEFT JOIN sub_categories sc ON sc.id = p.sub_category_id
          LEFT JOIN main_categories m ON sc.main_category_id = m.id
          LEFT JOIN products_images pi ON p.id = pi.product_id
          LEFT JOIN images i ON i.id = pi.image_id
          LEFT JOIN (
              SELECT
                  pig.product_id pid,
                  JSON_ARRAYAGG(ig.name) ig_array
              FROM ingredients ig
              JOIN products_ingredients pig ON pig.ingredient_id = ig.id
              GROUP BY pig.product_id
          ) joined_ig ON joined_ig.pid = p.id        
          ${condition}
          ${ordering}
          ${paging}`
          );
        } catch (err) {
          err.message = 'DATABASE_ERROR';
          err.statusCode = 400;
          throw err;
        }
      };
      
      ```
      
      - [orderBy - sorting], [offset - limit]ê³¼ ê°™ì´ ê²½ìš° ë°˜ë“œì‹œ pairë¡œ ë“¤ì–´ì™€ì•¼í•˜ëŠ” ê²½ìš°ë¥¼ ì»¤ë²„í•˜ê¸° ìœ„í•´ productService í•¨ìˆ˜ ë‚´ì— ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

      ```JavaScript
      //productService.js - ë°˜ë“œì‹œ í•¨ê»˜ ë“¤ì–´ì™€ì•¼ í•˜ëŠ” ì¸ìì— ëŒ€í•œ ì—ëŸ¬ì²˜ë¦¬ ifë¬¸

      if (!orderBy !== !sorting) {
        const err = new Error('CONDITION_NEEDS_TO_BE_PAIR');
        err.statusCode = 400;
        throw err;
      }

      if (!offset !== !limit) {
        const err = new Error('CONDITION_NEEDS_TO_BE_PAIR');
        err.statusCode = 400;
        throw err;
      }
      ```
    </div>
    </details>
  
  <br>
    
 **2. ê²°ì œ API - ì”ì•¡ ë¶€ì¡± ì—ëŸ¬ í•´ê²°**
- point ê²°ì œ API í†µì‹  ì¤‘, userì˜ ë³´ìœ  pointê°€ ì¶©ë¶„í•¨ì—ë„ ì”ì•¡ ë¶€ì¡± Errorê°€ ë°œìƒí•˜ëŠ” ìƒí™©ì´ ìƒê²¼ìŠµë‹ˆë‹¤. 
- ë¶„ëª… ì”ì•¡ pointê°€ ì¶©ë¶„í•¨ì„ í™•ì¸í–ˆê³ , ì½”ë“œë¥¼ ì•„ë¬´ë¦¬ ì³ë‹¤ë´ë„ ì™œ errorê°€ ë‚˜ëŠ”ì§€ ì´í•´í•  ìˆ˜ ì—†ì—ˆëŠ”ë°, console.log()ë¡œ ë°ì´í„° íƒ€ì…ì„ í™•ì¸í•´ë³´ë‹ˆ ë¬¸ì œë¥¼ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

  <details>
  <summary>ê¸°ì¡´ ì½”ë“œ</summary>
  <div markdown="1">

    ```JavaScript
    //orderService.js - ì”ì•¡ì´ ì¶©ë¶„í•´ë„ ì”ì•¡ ë¶€ì¡± ì—ëŸ¬ê°€ ë‚¬ë˜ ê¸°ì¡´ ì½”ë“œ

    if (user.point < order.totalPrice) {
        const err = new Error('INSUFFICIENT_POINT');
        err.statusCode = 400;
        throw err;
    };
    ```

  </div>
  </details>

  
- user.pointì™€ order.totalPriceê°€ `string` íƒ€ì…ìœ¼ë¡œ ì¸ì‹ë˜ì–´ user.pointê°€ [10,000,000] ìˆë”ë¼ë„ order.totalPriceê°€ [900,000]ì´ë¼ë©´ ifë¬¸ì´ ë™ì‘í•˜ì—¬ ì—ëŸ¬ë¡œ ì¸ì‹ë˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
- ë‘˜ì„ number íƒ€ì…ìœ¼ë¡œ ì¸ì‹ì‹œí‚¤ê¸° ìœ„í•´ ì½”ë“œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. 
  
  <details>
  <summary>ìˆ˜ì •ëœ ì½”ë“œ</summary>
  <div markdown="1">
    
   ```JavaScript
    //orderService.js - ìˆ«ìë¡œ ì¸ì‹ë˜ë„ë¡ ìˆ˜ì •í•œ ì½”ë“œ

    if (user.point - order.totalPrice < 0) {
        const err = new Error('INSUFFICIENT_POINT');
        err.statusCode = 400;
        throw err;
    }
   ```

  </div>
  </details>

<br>
  
***

## Reference

- ì´ í”„ë¡œì íŠ¸ëŠ” [ì´ì†](https://www.aesop.com/kr/) ì‚¬ì´íŠ¸ë¥¼ ì°¸ì¡°í•˜ì—¬ í•™ìŠµëª©ì ìœ¼ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
- ì‹¤ë¬´ìˆ˜ì¤€ì˜ í”„ë¡œì íŠ¸ì´ì§€ë§Œ í•™ìŠµìš©ìœ¼ë¡œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— ì´ ì½”ë“œë¥¼ í™œìš©í•˜ì—¬ ì´ë“ì„ ì·¨í•˜ê±°ë‚˜ ë¬´ë‹¨ ë°°í¬í•  ê²½ìš° ë²•ì ìœ¼ë¡œ ë¬¸ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì‚¬ì§„ ëŒ€ë¶€ë¶„ì€ ìœ„ì½”ë“œì—ì„œ êµ¬ë§¤í•œ ê²ƒì´ë¯€ë¡œ í•´ë‹¹ í”„ë¡œì íŠ¸ ì™¸ë¶€ì¸ì´ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
